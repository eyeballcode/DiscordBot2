let getLessonsURL = 'https://jmss-vic.compass.education/Services/Activity.svc/GetLessonsByActivityId?sessionstate=readonly'
let submitDataURL = 'https://localhost/classes'

let start = 30939
let end = 31244

let known = [30105,30106,30161,30162,30202,30107,30108,30109,30110,30129,30130,30151,30152,30166,30207,30111,30131,30132,30153,30187,30188,30208,30209,30112,30210,30113,30114,30115,30116,30137,30170,30171,30192,30193,30261,30268,30275,30117,30138,30139,30154,30155,30172,30173,30194,30215,30118,30119,30216,30217,30120,30121,30156,30157,30197,30198,30122,30123,30159,30176,30177,30124,30125,30142,30143,30182,30183,30203,30204,30126,30127,30144,30145,30163,30164,30184,30185,30205,30128,30133,30134,30135,30136,30140,30141,30178,30146,30165,30147,30148,30149,30150,30158,30218,30160,30179,30167,30168,30169,30174,30175,30199,30180,30181,30201,30186,30189,30190,30191,30195,30196,30200,30206,30211,30212,30213,30214,30219,30226,30233,30240,30247,30254,30220,30227,30234,30241,30248,30255,30262,30269,30276,30221,30228,30235,30242,30249,30256,30263,30270,30278,30222,30229,30236,30243,30250,30257,30264,30271,30279,30223,30230,30237,30244,30251,30258,30265,30224,30231,30225,30232,30238,30239,30246,30245,30252,30253,30267,30274,30259,30260,30273,30281,30282,30266,30272,30277,30280,30283,30284,30285,30286,30287,30288,30289,30290,30291,30292,30386,30387,30388,30389,30390,30391,30392,30393,30394,30293,30294,30295,30296,30297,30298,30299,30300,30301,30302,30303,30304,30305,30306,30307,30308,30309,30310,30311,30312,30313,30314,30315,30316,30317,30318,30319,30320,30321,30322,30323,30324,30325,30326,30327,30328,30329,30330,30331,30332,30333,30334,30344,30345,30510,30511,30512,30513,30350,30352,30353,30354,30355,30356,30357,30358,30359,30360,30361,30362,30363,30364,30365,30366,30367,30368,30369,30370,30371,30372,30373,30374,30375,30376,30377,30378,30379,30380,30381,30383,30384,30385,30442,30443,30444,30445,30446,30447,30448,30449,30450,30451,30452,30453,30454,30457,30458,30459,30460,30461,30462,30463,30464,30465,30466,30467,30468,30469,30470,30475,30476,30477,30478,30479,30480,30481,30482,30484,30485,30486,30487,30489,30490,30491,30492,30493,30494,30495,30497,30498,30499,30501,30503,30518,30540,30541,30542,30558,30559,30560,30561,30562,30563,30564,30565,30571,30577,30587,30588,30631,30697,30725,30745,30767,30801,30824,30835,30875,30900,31132,31171,31172,31187,31198,31213,30395,30403,30411,30418,30425,30432,30396,30404,30412,30419,30433,30397,30405,30413,30427,30398,30406,30414,30421,30428,30399,30407,30415,30422,30429,30435,30400,30626,30401,30409,30417,30424,30430,30438,30402,30408,30410,30431,30439,30416,30420,30426,30434,30423,30436,30437,30500,30674,31044,30502,30578,30579,30580,30581,30582,30583,30584,30585,30586,30589,30590,30592,30591,30596,30597,30598,30599,30600,30601,30602,30603,30604,30605,30606,30607,30608,30609,30610,30611,30612,30613,30614,30615,30616,30617,30618,30619,30620,30621,30622,30623,30624,30665,30666,30667,30668,30669,30670,30786,30787,30788,30789,30790,30791,30792,30793,30794,30974,30975,30995,30868,30869,30870,30871,30942,30943,30908,31091,31092,31093,31094,31095,31096,31097,31098,31099,31100,31101,31102,31103,31104,31105,31106,31107,31108,31109,31110,31111,31112,31113,31114,31115,31116,31117,31118,31119,31120,31121,31122,31123]

let activityCodes = []
for (let i = start; i <= end; i++) {
  if (!known.includes(i)) activityCodes.push(i)
}

activityCodes.forEach((activityId, i) => {
  setTimeout(() => {
    $.ajax({
      type: 'POST',
      url: getLessonsURL,
      data: JSON.stringify({ activityId }),
      contentType: 'application/json; charset=utf-8',
      success: data => {
        let instances = data.d.Instances.filter(instance => instance.RunningStatus)
        let classes = instances.map(instance => {
          return {
            classCode: instance.ActivityDisplayName,
            students: instance.AttendeeUserIdList,
            start: instance.st,
            end: instance.fn,
            teacher: instance.CoveringIid || instance.m,
            location: instance.l
          }
        })
        $.ajax({
          type: 'POST',
          url: submitDataURL,
          data: JSON.stringify(classes),
          contentType: 'application/json; charset=utf-8'
        })
      },
      dataType: 'json'
    })
  }, i * 700)
})
